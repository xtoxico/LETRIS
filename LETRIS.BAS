
10 CLS
20 WIDTH 80
30 RANDOMIZE TIMER
40 DIM FIELD(20,10), TETROMINO$(5,4)
50 LET SCORE = 0
60 GOSUB 9000 ' Inicializar fichas
70 GOSUB 2000 ' Bucle principal
80 END

1000 FOR I = 1 TO 20
1010   FOR J = 1 TO 10
1020     LOCATE I, J
1030     IF FIELD(I,J) = 1 THEN PRINT "X"; ELSE PRINT ".";
1040   NEXT J
1050 NEXT I
1060 LOCATE 1, 15: PRINT "SCORE: "; SCORE
1070 RETURN

2000 GOSUB 3000 ' Crear nueva pieza
2010 X = 5: Y = 1: R = 1
2020 TIMER0 = TIMER
2030 A$ = INKEY$
2040 IF A$ = "a" AND X > 1 THEN X = X - 1
2050 IF A$ = "d" AND X < 8 THEN X = X + 1
2055 IF A$ = "w" THEN R = R + 1: IF R > 4 THEN R = 1
2060 IF A$ = "s" THEN Y = Y + 1
2070 IF TIMER - TIMER0 > 0.5 THEN Y = Y + 1: TIMER0 = TIMER
2080 IF GOSUB 4000 THEN GOTO 2090
2085 GOSUB 1000: GOSUB 5000: GOTO 2030
2090 GOSUB 6000
2095 GOSUB 7000
2100 GOTO 2000

3000 P = INT(RND * 5) + 1
3010 RETURN

4000 T$ = TETROMINO$(P,R)
4010 FOR I = 1 TO LEN(T$)
4020   TX = X + I - 1
4030   TY = Y
4040   IF TY > 20 THEN RETURN TRUE
4050   IF FIELD(TY,TX) = 1 THEN RETURN TRUE
4060 NEXT I
4070 RETURN FALSE

5000 T$ = TETROMINO$(P,R)
5010 FOR I = 1 TO LEN(T$)
5020   LOCATE Y, X + I - 1
5030   PRINT MID$(T$, I, 1);
5040 NEXT I
5050 RETURN

6000 T$ = TETROMINO$(P,R)
6010 FOR I = 1 TO LEN(T$)
6020   TX = X + I - 1
6030   TY = Y
6040   FIELD(TY,TX) = 1
6050 NEXT I
6060 RETURN

7000 FOR I = 20 TO 1 STEP -1
7010   SUMA = 0
7020   FOR J = 1 TO 10
7030     IF FIELD(I,J) = 1 THEN SUMA = SUMA + 1
7040   NEXT J
7050   IF SUMA = 10 THEN
7060     FOR K = I TO 2 STEP -1
7070       FOR J = 1 TO 10
7080         FIELD(K,J) = FIELD(K-1,J)
7090       NEXT J
7100     NEXT K
7110     SCORE = SCORE + 100
7120     I = I + 1
7130   END IF
7140 NEXT I
7150 RETURN

9000 TETROMINO$(1,1) = "XX"
9010 TETROMINO$(1,2) = "XX"
9020 TETROMINO$(1,3) = "XX"
9030 TETROMINO$(1,4) = "XX"

9040 TETROMINO$(2,1) = "X X"
9050 TETROMINO$(2,2) = "XXX"
9060 TETROMINO$(2,3) = "X X"
9070 TETROMINO$(2,4) = "XXX"

9080 TETROMINO$(3,1) = "XX "
9090 TETROMINO$(3,2) = "X X"
9100 TETROMINO$(3,3) = " XX"
9110 TETROMINO$(3,4) = "X X"

9120 TETROMINO$(4,1) = " XX"
9130 TETROMINO$(4,2) = "X X"
9140 TETROMINO$(4,3) = "XX "
9150 TETROMINO$(4,4) = "X X"

9160 TETROMINO$(5,1) = "XXXX"
9170 TETROMINO$(5,2) = "X X X X"
9180 TETROMINO$(5,3) = "XXXX"
9190 TETROMINO$(5,4) = "X X X X"
9200 RETURN
